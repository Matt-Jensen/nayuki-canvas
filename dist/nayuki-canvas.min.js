"use strict";function updateNodes(){var e=this,t=this.canvasElem.clientWidth,n=this.canvasElem.clientHeight,o=this.nodes,i=t/Math.max(t,n),a=n/Math.max(t,n),r=[];o.forEach(function(t,n){t.posX+=t.velX*e.driftSpeed,t.posY+=t.velY*e.driftSpeed,t.velX=.99*t.velX+.3*(Math.random()-.5),t.velY=.99*t.velY+.3*(Math.random()-.5),n>=e.idealNumNodes||t.posX<e.config.BORDER_FADE||i-t.posX<e.config.BORDER_FADE||t.posY<e.config.BORDER_FADE||a-t.posY<e.config.BORDER_FADE?t.opacity=Math.max(t.opacity-e.config.FADE_OUT_RATE,0):t.opacity=Math.min(t.opacity+e.config.FADE_IN_RATE,1),t.opacity>0&&r.push(t)});for(var s=r.length;s<this.idealNumNodes;s++)r.push({posX:Math.random()*i,posY:Math.random()*a,radius:.015*(Math.pow(Math.random(),5)+.35),velX:0,velY:0,opacity:0});return this.doForceField(),r}function DisjointSet(e){function t(e){return n[e]!=e&&(n[e]=t(n[e])),n[e]}for(var n=[],o=[],i=0;e>i;i++)n.push(i),o.push(0);this.mergeSets=function(e,i){var a=t(e),r=t(i);if(a==r)return!1;var s=o[a]-o[r];return s>=0?(0==s&&o[a]++,n[r]=a):n[a]=r,!0}}function containsEdge(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.nodeA==t.nodeA&&o.nodeB==t.nodeB||o.nodeA==t.nodeB&&o.nodeB==t.nodeA)return!0}return!1}function calcSpanningTree(e,t){for(var n=[],o=new DisjointSet(t.length),i=0;i<e.length&&n.length<t.length-1;i++){var a=e[i],r=a[1],s=a[2];o.mergeSets(r,s)&&n.push({nodeA:t[r],nodeB:t[s]})}return n}function calcAllEdgeWeights(e,t){for(var n=[],o=0;o<e.length;o++)for(var i=e[o],a=0;o>a;a++){var r=e[a],s=Math.hypot(i.posX-r.posX,i.posY-r.posY);s/=Math.pow(i.radius*r.radius,t),n.push([s,o,a])}return n.sort(function(e,t){var n=_slicedToArray(e,1),o=n[0],i=_slicedToArray(t,1),a=i[0];return a>o?-1:o>a?1:0}),n}function updateEdges(){var e=this,t=0,n=this.nodes,o=this.edges,i=calcAllEdgeWeights(n,this.radiiWeightPower),a=calcSpanningTree(i,n);for(t=0;t<i.length&&a.length<n.length-1+this.maxExtraEdges;t++){var r={nodeA:n[i[t][1]],nodeB:n[i[t][2]]};containsEdge(a,r)||a.push(r)}i=null;var s=[];for(o.forEach(function(t){containsEdge(a,t)?t.opacity=Math.min(t.opacity+e.config.FADE_IN_RATE,1):t.opacity=Math.max(t.opacity-e.config.FADE_OUT_RATE,0),t.opacity>0&&t.nodeA.opacity>0&&t.nodeB.opacity>0&&s.push(t)}),t=0;t<a.length&&s.length<n.length-1+this.maxExtraEdges;t++){var d=a[t];containsEdge(s,d)||(d.opacity=0,s.push(d))}return s}function doForceField(){var e=0,t=[],n=this.repulsionForce,o=this.nodes;for(e=0;e<2*o.length;e++)t.push(0);for(e=0;e<o.length;e++)for(var i=o[e],a=0;e>a;a++){var r=o[a],s=i.posX-r.posX,d=i.posY-r.posY,c=s*s+d*d,u=n/(Math.sqrt(c)*(c+1e-5));s*=u,d*=u,t[2*e+0]+=s,t[2*e+1]+=d,t[2*a+0]-=s,t[2*a+1]-=d}for(e=0;e<o.length;e++)o[e].posX+=t[2*e+0],o[e].posY+=t[2*e+1]}function redrawCanvas(){var e=this.canvasElem,t=this.graphics,n=this.nodes,o=this.edges,i=e.width,a=e.height,r=Math.max(i,a),s=t.createRadialGradient(i/2,a/2,0,i/2,a/2,r/2);s.addColorStop(0,"#575E85"),s.addColorStop(1,"#2E3145"),t.fillStyle=s,t.fillRect(0,0,i,a),n.forEach(function(e){t.fillStyle="rgba(129,139,197,"+e.opacity.toFixed(3)+")",t.beginPath(),t.arc(e.posX*r,e.posY*r,e.radius*r,0,2*Math.PI),t.fill()}),t.lineWidth=r/800,o.forEach(function(e){var n=e.nodeA,o=e.nodeB,i=n.posX-o.posX,a=n.posY-o.posY,s=Math.hypot(i,a);if(s>n.radius+o.radius){i/=s,a/=s;var d=Math.min(Math.min(n.opacity,o.opacity),e.opacity);t.strokeStyle="rgba(129,139,197,"+d.toFixed(3)+")",t.beginPath(),t.moveTo((n.posX-i*n.radius)*r,(n.posY-a*n.radius)*r),t.lineTo((o.posX+i*o.radius)*r,(o.posY+a*o.radius)*r),t.stroke()}})}function initialize(){this.stepFrame();for(var e=0;300>e;e++)this.doForceField();this.edges=[],this.stepFrame(),this.nodes.concat(this.edges).forEach(function(e){e.opacity=1}),this.redrawCanvas()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],o=!0,i=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(d){i=!0,a=d}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),nayukiCore={updateNodes:updateNodes,updateEdges:updateEdges,doForceField:doForceField,redrawCanvas:redrawCanvas,initialize:initialize},networkStyleKey={mesh:0,balanced:.5,hubAndSpoke:1},nayukiCanvas={create:function(e,t){if(e instanceof HTMLElement==!1||"CANVAS"!==e.nodeName)throw new Error("Nayuki Canvas requires a canvas DOM node as the first argument");var n=Object.assign({extraEdges:20,numNodes:70,networkStyle:"balanced",driftSpeed:1,repulsionForce:1,BORDER_FADE:-.02,FADE_IN_RATE:.06,FADE_OUT_RATE:.03,FRAME_INTERVAL:20},t),o=Object.assign({},{config:n},nayukiCore),i=Object.create(o,{idealNumNodes:{get:function(){return parseInt(this.config.numNodes,10)}},maxExtraEdges:{get:function(){var e=this.config,t=e.extraEdges,n=e.numNodes;return Math.round(parseFloat(t)/100*n)}},radiiWeightPower:{get:function(){var e=this.config.networkStyle,t=networkStyleKey[e];return parseFloat(t)}},driftSpeed:{get:function(){var e=this.config.driftSpeed;return isNaN(e)?e:1e-4*e},set:function(e){return this.config.driftSpeed=parseFloat(e),this.driftSpeed}},repulsionForce:{get:function(){var e=this.config.repulsionForce;return isNaN(e)?e:1e-6*e},set:function(e){return this.config.repulsionForce=parseFloat(e),this.repulsionForce}}});i.canvasElem=e;i.graphics=e.getContext("2d");return i.nodes=[],i.edges=[],i.stepFrame=function(){this.canvasElem,this.graphics;this.nodes=this.updateNodes(),this.edges=this.updateEdges(),this.redrawCanvas()},i.initialize(),setInterval(function(){return i.stepFrame()},n.FRAME_INTERVAL),i}};"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=nayukiCanvas:"function"==typeof define&&"undefined"!=typeof define.amd?define(function(){return nayukiCanvas}):window&&!window.nayukiCanvas&&(window.nayukiCanvas=nayukiCanvas);
//# sourceMappingURL=nayuki-canvas.min.js.map
