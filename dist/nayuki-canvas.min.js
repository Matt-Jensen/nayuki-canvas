!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.nayukiCanvas=e()}(this,function(){"use strict";function t(){var t=arguments.length<=0||void 0===arguments[0]?this._nodes:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this._idealnodeCount:arguments[1],n=arguments.length<=2||void 0===arguments[2]?this._relWidth:arguments[2],r=arguments.length<=3||void 0===arguments[3]?this._relHeight:arguments[3],i=[];t.map(function(t){t.opacity>0&&i.push(t)});for(var o=i.length;e>o;o++)i.push({posX:Math.random()*n,posY:Math.random()*r,radius:.015*(Math.pow(Math.random(),5)+.35),velX:0,velY:0,opacity:0});return i}function e(){if("function"==typeof Math.hypot)return Math.hypot.apply(Math,arguments);for(var t=0,e=arguments.length,n=0;e>n;n++){if(arguments[n]===1/0||arguments[n]===-(1/0))return 1/0;t+=arguments[n]*arguments[n]}return Math.sqrt(t)}function n(t,n){for(var r=[],i=0;i<t.length;i++)for(var o=t[i],a=0;i>a;a++){var s=t[a],u=e(o.posX-s.posX,o.posY-s.posY);u/=Math.pow(o.radius*s.radius,n),r.push([u,i,a])}return r.sort(function(t,e){var n=N(t,1),r=n[0],i=N(e,1),o=i[0];return o>r?-1:r>o?1:0})}function r(t){for(var e={parents:{value:[]},ranks:{value:[],writable:!0}},n=0;t>n;n++)e.parents.value.push(n),e.ranks.value.push(0);return Object.create(A,e)}function i(t,e){for(var n=[],i=r(e.length),o=0;o<t.length&&n.length<e.length-1;o++){var a=t[o],s=N(a,3),u=s[1],d=s[2];i.mergeSets(u,d)&&n.push({nodeA:e[u],nodeB:e[d]})}return n}function o(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=r.nodeA===e.nodeA&&r.nodeB===e.nodeB,o=r.nodeA===e.nodeB&&r.nodeB===e.nodeA;if(i||o)return!0}return!1}function a(t){return t.opacity>0&&t.nodeA.opacity>0&&t.nodeB.opacity>0}function s(t,e){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return function(){return t.length<e.length-1+n}}function u(t){return"object"===("undefined"==typeof t?"undefined":S(t))&&t instanceof Array==!1}function d(t){if("function"==typeof Object.assign)return Object.assign.apply(Object,arguments);if(!u(t))throw new Error("Cannot perform assign on non-object");for(var e=1;e<arguments.length;e++){var n=arguments[e];if(u(n))for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}function h(){for(var t=arguments.length<=0||void 0===arguments[0]?this._nodes:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this._edges:arguments[1],r=arguments.length<=2||void 0===arguments[2]?this._maxExtraEdges:arguments[2],u=this,h=arguments.length<=3||void 0===arguments[3]?this._radiiWeightPower:arguments[3],l=arguments.length<=4||void 0===arguments[4]?this._getOpacity:arguments[4],c=[],f=n(t,h),g=i(f,t),p=s(g,t,r),v=0;v<f.length&&p();v++){var y={nodeA:t[f[v][1]],nodeB:t[f[v][2]]};o(g,y)||g.push(y)}e.map(function(t){var e=d({},t),n=o(g,e);e.opacity=l.apply(u,[n,e]),a(e)&&c.push(e)});for(var m=s(c,t,r),_=0;_<g.length&&m();_++){var b=g[_];o(c,b)||(b.opacity=0,c.push(b))}return c}function l(t,e,n){return Object.create(null,{nodeA:{value:t},nodeB:{value:e},repulsionForce:{value:n},x:{get:function(){var t=this.nodeA,e=this.nodeB;return t.posX-e.posX}},y:{get:function(){var t=this.nodeA,e=this.nodeB;return t.posY-e.posY}},distSqr:{get:function(){var t=this.x,e=this.y;return t*t+e*e}},factor:{get:function(){var t=this.distSqr,e=this.repulsionForce;return e/(Math.sqrt(t)*(t+1e-5))}},deltas:{get:function(){var t=this.x,e=this.y,n=this.factor;return{dx:t*n,dy:e*n}}}})}function c(t){return JSON.parse(JSON.stringify(t))}function f(){for(var t=arguments.length<=0||void 0===arguments[0]?this._nodes:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this._repulsionForce:arguments[1],n=[],r=c(t),i=0;i<2*r.length;i++)n.push(0);return r.forEach(function(t,i){for(var o=0;i>o;o++){var a=l(t,r[o],e),s=a.deltas,u=s.dx,d=s.dy;n[2*i+0]+=u,n[2*i+1]+=d,n[2*o+0]-=u,n[2*o+1]-=d}}),n}function g(t){var e=t.width,n=t.height,r=t.size,i=t.gradient,o=t.graphics,a=t.background,s=a instanceof Array,u=void 0;u=s?a:[a,a];var d=void 0;return d="linear"===M(i)?o.createLinearGradient(e/2,0,e/2,n):o.createRadialGradient(e/2,n/2,0,e/2,n/2,r/2),u.forEach(function(t,e,n){var r=n.length;d.addColorStop(e/(r-1),t)}),d}function p(t,e){return e>t.nodeA.radius+t.nodeB.radius}function v(t){var n=d({width:t.canvasElem.width,height:t.canvasElem.height,size:Math.max(t.canvasElem.width,t.canvasElem.height)},t),r=j({isEdgeVisible:p},{background:{get:function(){return g(this._data)}},nodes:{get:function(){var t=this._data,e=t.size,n=t.nodeSize,r=t.nodeColor;return this._data.nodes.map(function(t){return{fill:"rgba("+O.hexToRGB(r)+","+t.opacity.toFixed(3)+")",arc:[t.posX*e,t.posY*e,t.radius*n,0,2*Math.PI]}})}},edges:{get:function(){var t=this,n=this._data,r=n.size,i=n.nodeSize,o=n.edgeColor;return this._data.edges.map(function(n){var a=n.nodeA,s=n.nodeB,u=a.posX-s.posX,d=a.posY-s.posY,h=Math.min(Math.min(a.opacity,s.opacity),n.opacity),l=e(u,d);return u/=l,d/=l,t.isEdgeVisible(n,l)===!1?!1:{style:"rgba("+O.hexToRGB(o)+","+h.toFixed(3)+")",start:[(a.posX-u*(a.radius*(i/r)))*r,(a.posY-d*(a.radius*(i/r)))*r],end:[(s.posX+u*(s.radius*(i/r)))*r,(s.posY+d*(s.radius*(i/r)))*r]}}).filter(function(t){return t})}}});return d(r,{_data:n})}function y(){var t=arguments.length<=0||void 0===arguments[0]?this._nodes:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this._edges:arguments[1],n=arguments.length<=2||void 0===arguments[2]?this._canvasElem:arguments[2],r=arguments.length<=3||void 0===arguments[3]?this._graphics:arguments[3],i=arguments.length<=4||void 0===arguments[4]?this.background:arguments[4],o=arguments.length<=5||void 0===arguments[5]?this.gradient:arguments[5],a=arguments.length<=6||void 0===arguments[6]?this.nodeColor:arguments[6],s=arguments.length<=7||void 0===arguments[7]?this.edgeColor:arguments[7],u=arguments.length<=8||void 0===arguments[8]?this.edgeSize:arguments[8],d=arguments.length<=9||void 0===arguments[9]?this.nodeSize:arguments[9],h=v({canvasElem:n,graphics:r,nodes:t,edges:e,background:i,gradient:o,nodeColor:a,edgeColor:s,nodeSize:d});return r.fillStyle=h.background,r.fillRect(0,0,h._data.width,h._data.height),r.lineWidth=u,h.edges.forEach(function(t){r.strokeStyle=t.style,r.beginPath(),r.moveTo.apply(r,k(t.start)),r.lineTo.apply(r,k(t.end)),r.stroke()}),h.nodes.forEach(function(t){r.fillStyle=t.fill,r.beginPath(),r.arc.apply(r,k(t.arc)),r.fill()}),h}function m(t,e){var n=arguments.length<=2||void 0===arguments[2]?this.fadeInRate:arguments[2],r=arguments.length<=3||void 0===arguments[3]?this.fadeOutRate:arguments[3];return t?Math.min(e.opacity+n,1):Math.max(e.opacity-r,0)}function _(){for(var t=0;70>t;t++)this.next();return this}function b(){var t=arguments.length<=0||void 0===arguments[0]?this._idealnodeCount:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this._relWidth:arguments[1],n=this,r=arguments.length<=2||void 0===arguments[2]?this._relHeight:arguments[2],i=arguments.length<=3||void 0===arguments[3]?this.borderFade:arguments[3],o=function(t){var n=t.posX,o=t.posY;return i>n||i>e-n||i>o||i>r-o};this._nodes.map(function(e,r){var i=!(r>=t||o(e));return e.opacity=n._getOpacity(i,e),e}),this._nodes=this._updateNodes();var a=this._getNodeDeltas();return this._nodes.map(function(t,e){return t.posX+=a[2*e+0],t.posY+=a[2*e+1],t}),this._edges=this._updateEdges(),this._redrawCanvas(),this}function w(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?Function:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=function(t){return String.prototype.toLowerCase.call(t)};return n&&t instanceof n&&"function"==typeof t.get&&(t=t.get(0)),t instanceof e==!0&&"canvas"===r(t.nodeName)?t:!1}function E(){var t="object"===("undefined"==typeof document?"undefined":S(document))&&document.createElement&&document.createElement("canvas");return!!(t&&t.getContext&&t.getContext("2d"))}function x(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(t=X?{}:w(t,HTMLElement,window.jQuery||window.$),!t)throw new Error("Nayuki Canvas: requires a Canvas element as it's first argument");var n=d({},C,e),r=R(T,B);return d(r,n),E()?r._graphics=t.getContext("2d"):r._graphics={},r._canvasElem=t,r._nodes=[],r._edges=[],function(){var t=void 0;r.setTimeout=setTimeout.bind(X?global:window),r.clearTimeout=clearTimeout.bind(X?global:window),r.start=function(){var e=this,n=arguments.length<=0||void 0===arguments[0]?NaN:arguments[0];return n!==t&&void 0!==t||(t=this.setTimeout(function(){e.next(),e.start(t)},this.frameInterval)),this},r.stop=function(){return t=this.clearTimeout(t),this}}(),r.destroy=function(){return this.stop(),this._graphics.clearRect(0,0,r.width,r.height),this._graphics=this._canvasElem=this._nodes=this._edges=null,this},r}var C={extraEdges:20,nodeCount:70,network:"balanced",repulsion:1,borderFade:-.02,fadeInRate:.06,fadeOutRate:.03,frameInterval:20,background:["#0275d8","#055396"],gradient:"radial",nodeColor:"#f1f1f1",edgeColor:"#b4b4b4",edgeSize:.7,nodeSize:900},S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},N=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},A={getRepr:function(t){return this.parents[t]!==t&&(this.parents[t]=this.getRepr(this.parents[t])),this.parents[t]},mergeSets:function(t,e){var n=this.getRepr(t),r=this.getRepr(e);if(n===r)return!1;var i=this.ranks[n]-this.ranks[r];return i>=0?(0===i&&this.ranks[n]++,this.parents[r]=n):this.parents[n]=r,!0}},M=function(t){return String.prototype.slice.call(t)},O={_validatedHex:function(t){return t=(""+t).replace("#",""),3===t.length?t.split("").reduce(function(t,e){return t+e+e},""):t},hexToRGB:function(t){var e=parseInt(this._validatedHex(t),16);return(e>>16&255)+","+(e>>8&255)+","+(255&e)}},j=Object.create,B={_idealnodeCount:{get:function(){var t=parseInt(this.nodeCount,10);if(isNaN(t))throw new Error("Nayuki Canvas: `nodeCount` must be a number");return t}},_maxExtraEdges:{get:function(){var t=parseInt(this.extraEdges,10),e=parseInt(this.nodeCount,10);if(isNaN(t))throw new Error("Nayuki Canvas: `extraEdges` must be a number");if(isNaN(e))throw new Error("Nayuki Canvas: `nodeCount` must be a number");return Math.round(t/100*e)}},_radiiWeightPower:{get:function(){var t=this.network,e="string"==typeof t?t.toLowerCase():t,n=.5;return"mesh"===e?n=0:"wheel"===e&&(n=1),n}},_repulsionForce:{get:function(){var t=parseFloat(this.repulsion);if(isNaN(t))throw new Error("Nayuki Canvas: `replusion` must be a number");return 1e-6*t}},_relWidth:{get:function(){var t=this._canvasElem,e=t.width,n=t.height;return e/Math.max(e,n)}},_relHeight:{get:function(){var t=this._canvasElem,e=t.width,n=t.height;return n/Math.max(e,n)}}},R=Object.create,T={_updateNodes:t,_updateEdges:h,_getNodeDeltas:f,_redrawCanvas:y,_getOpacity:m,initialize:_,next:b},X="undefined"==typeof window&&"object"===("undefined"==typeof global?"undefined":S(global));return x.isSupported=E,x});