!function(){"use strict";function t(t,e){var n=t.posX,r=t.posY,a=t.velX,i=t.velY;return{posX:n+a*e,posY:r+i*e,velX:.99*a+.3*(Math.random()-.5),velY:.99*i+.3*(Math.random()-.5)}}function e(t,e,n,r){return t?Math.max(e-r,0):Math.min(e+n,1)}function n(){var n=this.canvasElem,r=n.width,a=n.height,i=this.nodes,o=this.idealNumNodes,s=this.driftSpeed,u=this.config,d=u.FADE_IN_RATE,c=u.FADE_OUT_RATE,h=u.BORDER_FADE,f=r/Math.max(r,a),p=a/Math.max(r,a),l=[],g=function(t,e){return e>=o||t.posX<h||f-t.posX<h||t.posY<h||p-t.posY<h};i.map(function(n,r){Object.assign({},n,t(n,s)),n.opacity=e(g(n,r),n.opacity,d,c),n.opacity>0&&l.push(n)});for(var v=l.length;o>v;v++)l.push({posX:Math.random()*f,posY:Math.random()*p,radius:.015*(Math.pow(Math.random(),5)+.35),velX:0,velY:0,opacity:0});return l}function r(t,e){for(var n=0;n<t.length;n++){var r=t[n],a=r.nodeA===e.nodeA&&r.nodeB===e.nodeB,i=r.nodeA===e.nodeB&&r.nodeB===e.nodeA;if(a||i)return!0}return!1}function a(t,e){for(var n=[],r=y.create(e.length),a=0;a<t.length&&n.length<e.length-1;a++){var i=t[a],o=E(i,3),s=o[1],u=o[2];r.mergeSets(s,u)&&n.push({nodeA:e[s],nodeB:e[u]})}return n}function i(t,e){for(var n=[],r=0;r<t.length;r++)for(var a=t[r],i=0;r>i;i++){var o=t[i],s=Math.hypot(a.posX-o.posX,a.posY-o.posY);s/=Math.pow(a.radius*o.radius,e),n.push([s,r,i])}return n.sort(function(t,e){var n=E(t,1),r=n[0],a=E(e,1),i=a[0];return i>r?-1:r>i?1:0})}function o(t){return JSON.parse(JSON.stringify(t))}function s(t,e,n,r){return t?Math.min(e.opacity+n,1):Math.max(e.opacity-r,0)}function u(t){return t.opacity>0&&t.nodeA.opacity>0&&t.nodeB.opacity>0}function d(t,e){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return function(){return t.length<e.length-1+n}}function c(){var t=0,e=this.nodes,n=this.edges,o=this.maxExtraEdges,c=this.radiiWeightPower,h=this.config,f=h.FADE_IN_RATE,p=h.FADE_OUT_RATE,l=[],g=i(e,c),v=a(g,e),y=d(v,e,o);for(t=0;t<g.length&&y();t++){var m={nodeA:e[g[t][1]],nodeB:e[g[t][2]]};r(v,m)||v.push(m)}n.map(function(t){var e=Object.assign({},t);e.opacity=s(r(v,e),e,f,p),u(e)&&l.push(e)});var E=d(l,e,o);for(t=0;t<v.length&&E();t++){var A=v[t];r(l,A)||(A.opacity=0,l.push(A))}return l}function h(t,e,n){return Object.create(null,{nodeA:{value:t},nodeB:{value:e},repulsionForce:{value:n},x:{get:function(){var t=this.nodeA,e=this.nodeB;return t.posX-e.posX}},y:{get:function(){var t=this.nodeA,e=this.nodeB;return t.posY-e.posY}},distSqr:{get:function(){var t=this.x,e=this.y;return t*t+e*e}},factor:{get:function(){var t=this.distSqr,e=this.repulsionForce;return e/(Math.sqrt(t)*(t+1e-5))}},deltas:{get:function(){var t=this.x,e=this.y,n=this.factor;return{dx:t*n,dy:e*n}}}})}function f(){for(var t=arguments.length<=0||void 0===arguments[0]?this.nodes:arguments[0],e=arguments.length<=1||void 0===arguments[1]?this.repulsionForce:arguments[1],n=[],r=o(t),a=0;a<2*r.length;a++)n.push(0);return r.forEach(function(t,a){for(var i=0;a>i;i++){var o=h(t,r[i],e),s=o.deltas,u=s.dx,d=s.dy;n[2*a+0]+=u,n[2*a+1]+=d,n[2*i+0]-=u,n[2*i+1]-=d}}),n}function p(t,e){return e>t.nodeA.radius+t.nodeB.radius}function l(){var t=this.canvasElem,e=this.graphics,n=this.nodes,r=this.edges,a=F.create({canvasElem:t,graphics:e,nodes:n,edges:r});return e.fillStyle=a.background,e.fillRect(0,0,a.data.width,a.data.height),a.nodes.forEach(function(t){e.fillStyle=t.fill,e.beginPath(),e.arc.apply(e,A(t.arc)),e.fill()}),e.lineWidth=a.data.size/800,a.edges.forEach(function(t){e.strokeStyle=t.style,e.beginPath(),e.moveTo.apply(e,A(t.start)),e.lineTo.apply(e,A(t.end)),e.stroke()}),a}function g(){for(var t=0;70>t;t++)this.stepFrame()}var v={getRepr:function(t){return this.parents[t]!==t&&(this.parents[t]=this.getRepr(this.parents[t])),this.parents[t]},mergeSets:function(t,e){var n=this.getRepr(t),r=this.getRepr(e);if(n===r)return!1;var a=this.ranks[n]-this.ranks[r];return a>=0?(0===a&&this.ranks[n]++,this.parents[r]=n):this.parents[n]=r,!0}},y={create:function(t){for(var e={parents:{value:[]},ranks:{value:[],writable:!0}},n=0;t>n;n++)e.parents.value.push(n),e.ranks.value.push(0);return Object.create(v,e)}},m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},E=function(){function t(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(u){a=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},b={create:function(t){var e=Object.assign({startColor:"#575E85",stopColor:"#2E3145"},t);return Object.create({data:e},{radialGradient:{get:function(){var t=this.data,e=t.width,n=t.height,r=t.size,a=t.graphics,i=t.startColor,o=t.stopColor,s=a.createRadialGradient(e/2,n/2,0,e/2,n/2,r/2);return s.addColorStop(0,i),s.addColorStop(1,o),s}}})}},F={create:function(t){var e=Object.assign({width:t.canvasElem.width,height:t.canvasElem.height,size:Math.max(t.canvasElem.width,t.canvasElem.height)},t);return Object.create({data:e,frameBackground:b,isEdgeVisible:p},{background:{get:function(){return this.frameBackground.create(this.data).radialGradient}},nodes:{get:function(){var t=this.data.size,e="129,139,197";return this.data.nodes.map(function(n){return{fill:"rgba("+e+","+n.opacity.toFixed(3)+")",arc:[n.posX*t,n.posY*t,n.radius*t,0,2*Math.PI]}})}},edges:{get:function(){var t=this,e=this.data.size,n="129,139,197";return this.data.edges.map(function(r){var a=r.nodeA,i=r.nodeB,o=a.posX-i.posX,s=a.posY-i.posY,u=Math.min(Math.min(a.opacity,i.opacity),r.opacity),d=Math.hypot(o,s);return o/=d,s/=d,t.isEdgeVisible(r,d)===!1?!1:{style:"rgba("+n+","+u.toFixed(3)+")",start:[(a.posX-o*a.radius)*e,(a.posY-s*a.radius)*e],end:[(i.posX+o*i.radius)*e,(i.posY+s*i.radius)*e]}}).filter(function(t){return t})}}})}},S={updateNodes:n,updateEdges:c,getNodeDeltas:f,redrawCanvas:l,initialize:g},w={mesh:0,balanced:.5,hubAndSpoke:1},M={create:function(t,e){if(t instanceof HTMLElement==!1||"CANVAS"!==t.nodeName)throw new Error("Nayuki Canvas requires a canvas DOM node as the first argument");var n=Object.assign({extraEdges:20,numNodes:70,networkStyle:"balanced",driftSpeed:1,repulsionForce:1,BORDER_FADE:-.02,FADE_IN_RATE:.06,FADE_OUT_RATE:.03,FRAME_INTERVAL:20},e),r=Object.assign({},{config:n},S),a=Object.create(r,{idealNumNodes:{get:function(){return parseInt(this.config.numNodes,10)}},maxExtraEdges:{get:function(){var t=this.config,e=t.extraEdges,n=t.numNodes;return Math.round(parseFloat(e)/100*n)}},radiiWeightPower:{get:function(){var t=this.config.networkStyle,e=w[t];return parseFloat(e)}},driftSpeed:{get:function(){var t=this.config.driftSpeed;return isNaN(t)?t:1e-4*t},set:function(t){return this.config.driftSpeed=parseFloat(t),this.driftSpeed}},repulsionForce:{get:function(){var t=this.config.repulsionForce;return isNaN(t)?t:1e-6*t},set:function(t){return this.config.repulsionForce=parseFloat(t),this.repulsionForce}}});return a.canvasElem=t,a.graphics=t.getContext("2d"),a.nodes=[],a.edges=[],a.stepFrame=function(){this.nodes=this.updateNodes();var t=this.getNodeDeltas();this.nodes.map(function(e,n){return e.posX+=t[2*n+0],e.posY+=t[2*n+1],e}),this.edges=this.updateEdges(),this.redrawCanvas()},setInterval(function(){return a.stepFrame()},n.FRAME_INTERVAL),a}};"object"===("undefined"==typeof exports?"undefined":m(exports))?module.exports=M:"function"==typeof define&&"undefined"!=typeof define.amd?define(function(){return M}):window&&!window.nayukiCanvas&&(window.nayukiCanvas=M)}();