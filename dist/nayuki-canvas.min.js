!function(){"use strict";function t(){var t=this,e=this.canvasElem.clientWidth,o=this.canvasElem.clientHeight,n=this.nodes,r=e/Math.max(e,o),i=o/Math.max(e,o),a=[];n.forEach(function(e,o){e.posX+=e.velX*t.driftSpeed,e.posY+=e.velY*t.driftSpeed,e.velX=.99*e.velX+.3*(Math.random()-.5),e.velY=.99*e.velY+.3*(Math.random()-.5),o>=t.idealNumNodes||e.posX<t.config.BORDER_FADE||r-e.posX<t.config.BORDER_FADE||e.posY<t.config.BORDER_FADE||i-e.posY<t.config.BORDER_FADE?e.opacity=Math.max(e.opacity-t.config.FADE_OUT_RATE,0):e.opacity=Math.min(e.opacity+t.config.FADE_IN_RATE,1),e.opacity>0&&a.push(e)});for(var s=a.length;s<this.idealNumNodes;s++)a.push({posX:Math.random()*r,posY:Math.random()*i,radius:.015*(Math.pow(Math.random(),5)+.35),velX:0,velY:0,opacity:0});return this.doForceField(),a}function e(t){function e(t){return o[t]!==t&&(o[t]=e(o[t])),o[t]}for(var o=[],n=[],r=0;t>r;r++)o.push(r),n.push(0);this.mergeSets=function(t,r){var i=e(t),a=e(r);if(i===a)return!1;var s=n[i]-n[a];return s>=0?(0===s&&n[i]++,o[a]=i):o[i]=a,!0}}function o(t,e){for(var o=0;o<t.length;o++){var n=t[o];if(n.nodeA===e.nodeA&&n.nodeB===e.nodeB||n.nodeA===e.nodeB&&n.nodeB===e.nodeA)return!0}return!1}function n(t,o){for(var n=[],r=new e(o.length),i=0;i<t.length&&n.length<o.length-1;i++){var a=t[i],s=a[1],d=a[2];r.mergeSets(s,d)&&n.push({nodeA:o[s],nodeB:o[d]})}return n}function r(t,e){for(var o=[],n=0;n<t.length;n++)for(var r=t[n],i=0;n>i;i++){var a=t[i],s=Math.hypot(r.posX-a.posX,r.posY-a.posY);s/=Math.pow(r.radius*a.radius,e),o.push([s,n,i])}return o.sort(function(t,e){var o=c.slicedToArray(t,1),n=o[0],r=c.slicedToArray(e,1),i=r[0];return i>n?-1:n>i?1:0}),o}function i(){var t=this,e=0,i=this.nodes,a=this.edges,s=r(i,this.radiiWeightPower),d=n(s,i);for(e=0;e<s.length&&d.length<i.length-1+this.maxExtraEdges;e++){var c={nodeA:i[s[e][1]],nodeB:i[s[e][2]]};o(d,c)||d.push(c)}s=null;var u=[];for(a.forEach(function(e){o(d,e)?e.opacity=Math.min(e.opacity+t.config.FADE_IN_RATE,1):e.opacity=Math.max(e.opacity-t.config.FADE_OUT_RATE,0),e.opacity>0&&e.nodeA.opacity>0&&e.nodeB.opacity>0&&u.push(e)}),e=0;e<d.length&&u.length<i.length-1+this.maxExtraEdges;e++){var h=d[e];o(u,h)||(h.opacity=0,u.push(h))}return u}function a(){var t=0,e=[],o=this.repulsionForce,n=this.nodes;for(t=0;t<2*n.length;t++)e.push(0);for(t=0;t<n.length;t++)for(var r=n[t],i=0;t>i;i++){var a=n[i],s=r.posX-a.posX,d=r.posY-a.posY,c=s*s+d*d,u=o/(Math.sqrt(c)*(c+1e-5));s*=u,d*=u,e[2*t+0]+=s,e[2*t+1]+=d,e[2*i+0]-=s,e[2*i+1]-=d}for(t=0;t<n.length;t++)n[t].posX+=e[2*t+0],n[t].posY+=e[2*t+1]}function s(){var t=this.canvasElem,e=this.graphics,o=this.nodes,n=this.edges,r=t.width,i=t.height,a=Math.max(r,i),s=e.createRadialGradient(r/2,i/2,0,r/2,i/2,a/2);s.addColorStop(0,"#575E85"),s.addColorStop(1,"#2E3145"),e.fillStyle=s,e.fillRect(0,0,r,i),o.forEach(function(t){e.fillStyle="rgba(129,139,197,"+t.opacity.toFixed(3)+")",e.beginPath(),e.arc(t.posX*a,t.posY*a,t.radius*a,0,2*Math.PI),e.fill()}),e.lineWidth=a/800,n.forEach(function(t){var o=t.nodeA,n=t.nodeB,r=o.posX-n.posX,i=o.posY-n.posY,s=Math.hypot(r,i);if(s>o.radius+n.radius){r/=s,i/=s;var d=Math.min(Math.min(o.opacity,n.opacity),t.opacity);e.strokeStyle="rgba(129,139,197,"+d.toFixed(3)+")",e.beginPath(),e.moveTo((o.posX-r*o.radius)*a,(o.posY-i*o.radius)*a),e.lineTo((n.posX+r*n.radius)*a,(n.posY+i*n.radius)*a),e.stroke()}})}function d(){this.stepFrame();for(var t=0;300>t;t++)this.doForceField();this.edges=[],this.stepFrame(),this.nodes.concat(this.edges).forEach(function(t){t.opacity=1}),this.redrawCanvas()}var c={};c["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},c.slicedToArray=function(){function t(t,e){var o=[],n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(o.push(a.value),!e||o.length!==e);n=!0);}catch(d){r=!0,i=d}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var u={updateNodes:t,updateEdges:i,doForceField:a,redrawCanvas:s,initialize:d},h={mesh:0,balanced:.5,hubAndSpoke:1},f={create:function(t,e){if(t instanceof HTMLElement==!1||"CANVAS"!==t.nodeName)throw new Error("Nayuki Canvas requires a canvas DOM node as the first argument");var o=Object.assign({extraEdges:20,numNodes:70,networkStyle:"balanced",driftSpeed:1,repulsionForce:1,BORDER_FADE:-.02,FADE_IN_RATE:.06,FADE_OUT_RATE:.03,FRAME_INTERVAL:20},e),n=Object.assign({},{config:o},u),r=Object.create(n,{idealNumNodes:{get:function(){return parseInt(this.config.numNodes,10)}},maxExtraEdges:{get:function(){var t=this.config,e=t.extraEdges,o=t.numNodes;return Math.round(parseFloat(e)/100*o)}},radiiWeightPower:{get:function(){var t=this.config.networkStyle,e=h[t];return parseFloat(e)}},driftSpeed:{get:function(){var t=this.config.driftSpeed;return isNaN(t)?t:1e-4*t},set:function(t){return this.config.driftSpeed=parseFloat(t),this.driftSpeed}},repulsionForce:{get:function(){var t=this.config.repulsionForce;return isNaN(t)?t:1e-6*t},set:function(t){return this.config.repulsionForce=parseFloat(t),this.repulsionForce}}});return r.canvasElem=t,r.graphics=t.getContext("2d"),r.graphics.translate(.5,.5),r.nodes=[],r.edges=[],r.stepFrame=function(){this.nodes=this.updateNodes(),this.edges=this.updateEdges(),this.redrawCanvas()},r.initialize(),setInterval(function(){return r.stepFrame()},o.FRAME_INTERVAL),r}};"object"===("undefined"==typeof exports?"undefined":c["typeof"](exports))?module.exports=f:"function"==typeof define&&"undefined"!=typeof define.amd?define(function(){return f}):window&&!window.nayukiCanvas&&(window.nayukiCanvas=f)}();