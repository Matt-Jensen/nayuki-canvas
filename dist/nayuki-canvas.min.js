"use strict";function containsEdge(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.nodeA==t.nodeA&&o.nodeB==t.nodeB||o.nodeA==t.nodeB&&o.nodeB==t.nodeA)return!0}return!1}function redrawCanvas(e,t,n,o){var r=e.width,a=e.height,i=Math.max(r,a),s=t.createRadialGradient(r/2,a/2,0,r/2,a/2,i/2);s.addColorStop(0,"#575E85"),s.addColorStop(1,"#2E3145"),t.fillStyle=s,t.fillRect(0,0,r,a),n.forEach(function(e){t.fillStyle="rgba(129,139,197,"+e.opacity.toFixed(3)+")",t.beginPath(),t.arc(e.posX*i,e.posY*i,e.radius*i,0,2*Math.PI),t.fill()}),t.lineWidth=i/800,o.forEach(function(e){var n=e.nodeA,o=e.nodeB,r=n.posX-o.posX,a=n.posY-o.posY,s=Math.hypot(r,a);if(s>n.radius+o.radius){r/=s,a/=s;var d=Math.min(Math.min(n.opacity,o.opacity),e.opacity);t.strokeStyle="rgba(129,139,197,"+d.toFixed(3)+")",t.beginPath(),t.moveTo((n.posX-r*n.radius)*i,(n.posY-a*n.radius)*i),t.lineTo((o.posX+r*o.radius)*i,(o.posY+a*o.radius)*i),t.stroke()}})}function DisjointSet$1(e){function t(e){return n[e]!=e&&(n[e]=t(n[e])),n[e]}for(var n=[],o=[],r=0;e>r;r++)n.push(r),o.push(0);this.mergeSets=function(e,r){var a=t(e),i=t(r);if(a==i)return!1;var s=o[a]-o[i];return s>=0?(0==s&&o[a]++,n[i]=a):n[a]=i,!0}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(d){r=!0,a=d}finally{try{!o&&s["return"]&&s["return"]()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),BORDER_FADE=-.02,FADE_IN_RATE=.06,FADE_OUT_RATE=.03,FRAME_INTERVAL=20,networkStyleKey={mesh:0,balanced:.5,hubAndSpoke:1},nayukiCanvas={create:function(e,t){if(e instanceof HTMLElement==!1||"CANVAS"!==e.nodeName)throw new Error("Nayuki Canvas requires a canvas DOM node as the first argument");var n=Object.assign({extraEdges:20,numNodes:70,networkStyle:"balanced",driftSpeed:1,repulsionForce:1},t),o=Object.assign({},{config:n},nayukiCanvas.core),r=Object.create(o,{idealNumNodes:{get:function(){return parseInt(this.config.numNodes,10)}},maxExtraEdges:{get:function(){var e=this.config,t=e.extraEdges,n=e.numNodes;return Math.round(parseFloat(t)/100*n)}},radiiWeightPower:{get:function(){var e=this.config.networkStyle,t=networkStyleKey[e];return parseFloat(t)}},driftSpeed:{get:function(){var e=this.config.driftSpeed;return isNaN(e)?void 0:1e-4*e},set:function(e){return this.config.driftSpeed=parseFloat(e),this.driftSpeed}},repulsionForce:{get:function(){var e=this.config.repulsionForce;return isNaN(e)?void 0:1e-6*e},set:function(e){return this.config.repulsionForce=parseFloat(e),this.repulsionForce}}});r.canvasElem=e;r.graphics=e.getContext("2d");return r.nodes=[],r.edges=[],setTimeout(r.stepFrame.bind(r),FRAME_INTERVAL),r},core:{stepFrame:function(){var e=this.canvasElem,t=this.graphics,n=this.nodes,o=this.edges;n=this.updateNodes(e.width,e.height,n),o=this.updateEdges(n,o),redrawCanvas(e,t,n,o)},_initialize:function(){this.stepFrame();for(var e=0;300>e;e++)this.doForceField(nodes);this.edges=[],this.stepFrame(),this.nodes.concat(this.edges).forEach(function(e){e.opacity=1}),redrawCanvas(this.canvasElem,this.graphics,this.nodes,this.edges)},updateNodes:function(e,t,n){var o=e/Math.max(e,t),r=t/Math.max(e,t),a=[];n.forEach(function(e,t){e.posX+=e.velX*driftSpeed,e.posY+=e.velY*driftSpeed,e.velX=.99*e.velX+.3*(Math.random()-.5),e.velY=.99*e.velY+.3*(Math.random()-.5),t>=this.idealNumNodes||e.posX<BORDER_FADE||o-e.posX<BORDER_FADE||e.posY<BORDER_FADE||r-e.posY<BORDER_FADE?e.opacity=Math.max(e.opacity-FADE_OUT_RATE,0):e.opacity=Math.min(e.opacity+FADE_IN_RATE,1),e.opacity>0&&a.push(e)});for(var i=a.length;i<this.idealNumNodes;i++)a.push({posX:Math.random()*o,posY:Math.random()*r,radius:.015*(Math.pow(Math.random(),5)+.35),velX:0,velY:0,opacity:0});return this.doForceField(a),a},updateEdges:function(e,t){var n=0,o=this.calcAllEdgeWeights(e),r=this.calcSpanningTree(o,e);for(n=0;n<o.length&&r.length<e.length-1+this.maxExtraEdges;n++){var a={nodeA:e[o[n][1]],nodeB:e[o[n][2]]};containsEdge(r,a)||r.push(a)}o=null;var i=[];for(t.forEach(function(e){containsEdge(r,e)?e.opacity=Math.min(e.opacity+FADE_IN_RATE,1):e.opacity=Math.max(e.opacity-FADE_OUT_RATE,0),e.opacity>0&&e.nodeA.opacity>0&&e.nodeB.opacity>0&&i.push(e)}),n=0;n<r.length&&i.length<e.length-1+this.maxExtraEdges;n++){var s=r[n];containsEdge(i,s)||(s.opacity=0,i.push(s))}return i},doForceField:function(e){var t=0,n=[];for(t=0;t<2*e.length;t++)n.push(0);for(t=0;t<e.length;t++)for(var o=e[t],r=0;t>r;r++){var a=e[r],i=o.posX-a.posX,s=o.posY-a.posY,d=i*i+s*s,c=this.repulsionForce/(Math.sqrt(d)*(d+1e-5));i*=c,s*=c,n[2*t+0]+=i,n[2*t+1]+=s,n[2*r+0]-=i,n[2*r+1]-=s}for(t=0;t<e.length;t++)e[t].posX+=n[2*t+0],e[t].posY+=n[2*t+1]},calcAllEdgeWeights:function(e){for(var t=[],n=0;n<e.length;n++)for(var o=e[n],r=0;n>r;r++){var a=e[r],i=Math.hypot(o.posX-a.posX,o.posY-a.posY);i/=Math.pow(o.radius*a.radius,this.radiiWeightPower),t.push([i,n,r])}return t.sort(function(e,t){var n=_slicedToArray(e,1),o=n[0],r=_slicedToArray(t,1),a=r[0];return a>o?-1:o>a?1:0}),t},calcSpanningTree:function(e,t){for(var n=[],o=new DisjointSet$1(t.length),r=0;r<e.length&&n.length<t.length-1;r++){var a=e[r],i=a[1],s=a[2];o.mergeSets(i,s)&&n.push({nodeA:t[i],nodeB:t[s]})}return n}}};"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=nayukiCanvas:"function"==typeof define&&"undefined"!=typeof define.amd?define(function(){return nayukiCanvas}):window&&!window.nayukiCanvas&&(window.nayukiCanvas=nayukiCanvas);
//# sourceMappingURL=nayuki-canvas.min.js.map
